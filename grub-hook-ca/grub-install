#!/usr/bin/env bash

# Install grub files into /boot
/usr/bin/grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=GRUB --modules="tpm" --disable-shim-lock
# Create BOOTX64 file if not present. if already present check if it is grub. If it is grub then update. If not dont do any thing to it.
if [[ -f /boot/EFI/BOOT/BOOTX64.EFI ]]; then
  if strings /boot/EFI/BOOT/BOOTX64.EFI | grep -qi grub; then
    /usr/bin/grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=GRUB --modules="tpm" --disable-shim-lock --removable
  fi
else
    /usr/bin/grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=GRUB --modules="tpm" --disable-shim-lock --removable
fi
# create config
/usr/bin/grub-mkconfig -o /boot/grub/grub.cfg
# secureboot signing
[[ -f /usr/bin/sbctl ]] && /usr/bin/sbctl sign-all -g
